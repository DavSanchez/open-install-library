---

- debug:
    msg: Install .net Core linux web application

- set_fact:
    web_application_url: http://open-install-library-artifacts.s3.us-west-2.amazonaws.com/linux/.net/CoreLinuxWebApplication.zip

- name: Install unzip
  shell: "apt-get install unzip -y"
  become: true

- name: Download web application
  shell: "curl -i \"{{ web_application_url }}\" -o {{ service_id }}.zip"

- name: Remove application directory
  shell: "rm -rf ~/{{ service_id}}"

- name: Create application directory
  file:
    path: "~/{{ service_id}}"
    state: directory

- name: Extract application
  shell: "unzip ../{{ service_id }}.zip"
  ignore_errors: yes
  args:
    chdir: "~/{{ service_id}}"

- name: Exec permission
  shell: "chmod +x {{ service_id}}/CoreLinuxWebApplication"
  become: true

- name: Create systemd service file
  template:
    src: systemctl.service
    dest: "/lib/systemd/system/{{service_id}}.service"
  become: true
