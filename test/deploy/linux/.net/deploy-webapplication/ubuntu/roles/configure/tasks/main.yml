---

- debug:
    msg: Install .net Core linux web application

- set_fact:
    web_application_url: http://open-install-library-artifacts.s3.us-west-2.amazonaws.com/linux/.net/CoreLinuxWebApplication.zip

- shell: wget -q https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb
- shell: dpkg -i packages-microsoft-prod.deb
  become: true
- shell: add-apt-repository universe
  become: true
- shell: apt-get install apt-transport-https
  become: true
- shell: dpkg -i packages-microsoft-prod.deb
  become: true
- name: Get latest packages info
  shell: "apt-get update -y"
  become: true

- name: Install .net core
  shell: "apt-get install dotnet-sdk-2.2 -y"
  become: true
- name: Install unzip
  shell: "apt-get install unzip -y"
  become: true

- name: Download web application
  shell: "curl -i \"{{ web_application_url }}\" -o {{ service_id }}.zip"

- name: Extract application
  shell: "unzip ../service_id.zip"
  args:
    chdir: "~/{{ service_id}}"

- name: Exec permission
  shell: "chmod +x service_id/CoreLinuxWebApplication"
  become: true

- name: Create systemd service file
  template:
    src: systemctl.service
    dest: "/lib/systemd/system/{{service_id}}.service"
  become: true
