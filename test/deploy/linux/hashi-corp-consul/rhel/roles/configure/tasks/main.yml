---
- debug:
    msg: Install HashiCorp Consul

- name: Update packages
  shell: yum update -y
  become: true

- name: Install yum utils
  shell: yum install -y yum-utils
  become: true

- name: Add official HashiCorp Linux Repository
  shell: sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
  become: true

- name: Install HashiCorp Consul
  shell: yum install consul -y
  become: true 

- name: Start the agent
  shell: consul agent
  become: true 

- name: Restart the service
  shell: systemctl restart consul
  become: true

- name: Export NR_CLI_HOSTNAME
  shell: "echo export NR_CLI_HOSTNAME=localhost >> ~/.bashrc"

- name: Export NR_CLI_PORT
  shell: "echo export NR_CLI_PORT=8500 >> ~/.bashrc"

- name: Export NR_CLI_TOKEN
  shell: "echo export NR_CLI_TOKEN="" >> ~/.bashrc"

- name: Export NR_CLI_ENABLE_SSL
  shell: "echo export NR_CLI_ENABLE_SSL=fasle >> ~/.bashrc"

- name: Export NR_CLI_CA_BUNDLE_DIR
  shell: "echo export NR_CLI_CA_BUNDLE_DIR="" >> ~/.bashrc"

- name: Export NR_CLI_CA_BUNDLE_FILE
  shell: "echo export NR_CLI_CA_BUNDLE_DIR="" >> ~/.bashrc"

- name: Export NR_CLI_TRUST_SERVER_CERTIFICATE
  shell: "echo export NR_CLI_TRUST_SERVER_CERTIFICATE=fasle >> ~/.bashrc"
