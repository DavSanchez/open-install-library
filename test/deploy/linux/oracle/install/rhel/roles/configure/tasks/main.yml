---
- debug:
    msg: Install Oracle

- name: Set default create_env_var (default not create)
  set_fact:
    create_env_var: "false"
  when: create_env_var is undefined

- name: update packages
  shell: yum update -y
  become: true

- name: get oracledb-preinstall
  shell: curl -o oracle-database-preinstall-18c-1.0-1.el7.x86_64.rpm https://yum.oracle.com/repo/OracleLinux/OL7/latest/x86_64/getPackage/oracle-database-preinstall-18c-1.0-1.el7.x86_64.rpm
  become: true

- name: install oracledb
  shell: yum -y localinstall oracle-database-preinstall-18c-1.0-1.el7.x86_64.rpm
  become: true

- block:
  - name: Export USERNAME
    shell: "echo export NR_CLI_ORACLEDB_USERNAME=newrelic >> ~/.bashrc"
  - name: Export PASSWORD
    shell: "echo export NR_CLI_ORACLEDB_PASSWORD=Virtuoso4all! >> ~/.bashrc"
  - name: Export HOSTNAME
    shell: "echo export NR_CLI_ORACLEDB_HOST=localhost >> ~/.bashrc"
  - name: Export DB_PORT
    shell: "echo export NR_CLI_ORACLEDB_PORT=1521 >> ~/.bashrc"
  - name: Export ORACLE_HOME_PATH
    shell: "echo export NR_CLI_ORACLEDB_HOME_PATH=/etc/oracledb >> ~/.bashrc"
  - name: Export ORACLE_SERVICE_NAME
    shell: "echo export NR_CLI_ORACLEDB_SERVICE_NAME=ORCL >> ~/.bashrc"
  - name: Export ORACLE_CUSTOM_METRICS_CONFIG
    shell: "echo export NR_CLI_ORACLEDB_CUSTOM_METRICS_CONFIG=/path/to/yaml/file  >> ~/.bashrc"
  - name: Export ORACLE_SYS_DBA
    shell: "echo export NR_CLI_ORACLEDB_SYS_DBA=false  >> ~/.bashrc"
  - name: Export ORACLE_SYS_OPER
    shell: "echo export NR_CLI_ORACLEDB_SYS_OPER=false  >> ~/.bashrc"
  - name: Export ORACLE_EXTENDED_METRICS
    shell: "echo export NR_CLI_ORACLEDB_EXTENDED_METRICS=false  >> ~/.bashrc"
  when: create_env_var|bool

