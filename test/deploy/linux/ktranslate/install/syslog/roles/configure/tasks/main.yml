---
- debug:
    msg: Configure Syslog Cron

- name: Set default create_env_var (default not create)
  set_fact:
    create_env_var: "false"
  when: create_env_var is undefined

- name: Copy syslog message gen script
  template:
    src: syslog-gen.sh
    dest: /usr/bin/syslog-gen
    force: yes
    mode: "0777"
  become: true

- name: Run syslog-gen to post test messages on port 514
  shell: /usr/bin/syslog-gen
  async: 86400 # 60*60*24 â€“ 1 day
  poll: 0

- block:
    - name: Export NR_CLI_SERVICE_NAME
      shell: "echo export NR_CLI_SERVICE_NAME=syslog >> ~/.bashrc"
  when: create_env_var|bool
