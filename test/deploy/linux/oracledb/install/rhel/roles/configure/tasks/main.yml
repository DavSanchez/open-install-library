---
- debug:
    msg: Install Oracle

- name: Set default create_env_var (default not create)
  set_fact:
    create_env_var: "false"
  when: create_env_var is undefined

- name: update packages
  shell: yum update -y
  become: true

- name: get oracle client
  shell: wget https://download.oracle.com/otn_software/linux/instantclient/211000/oracle-instantclient-basic-21.1.0.0.0-1.x86_64.rpm -P /etc/
  become: true

- name: install oracledb
  shell: yum install -y oracle-instantclient19.3-basic-19.3.0.0.0-1.x86_64.rpm
  become: true

- block:
  - name: Export USERNAME
    shell: "echo export NR_CLI_ORACLEDB_USERNAME=newrelic >> ~/.bashrc"
  - name: Export PASSWORD
    shell: "echo export NR_CLI_ORACLEDB_PASSWORD=Virtuoso4all! >> ~/.bashrc"
  - name: Export HOSTNAME
    shell: "echo export NR_CLI_ORACLEDB_HOST=localhost >> ~/.bashrc"
  - name: Export DB_PORT
    shell: "echo export NR_CLI_ORACLEDB_PORT=1521 >> ~/.bashrc"
  - name: Export ORACLE_HOME_PATH
    shell: "echo export NR_CLI_ORACLEDB_HOME_PATH=/etc/oracledb >> ~/.bashrc"
  - name: Export ORACLE_SERVICE_NAME
    shell: "echo export NR_CLI_ORACLEDB_SERVICE_NAME=ORCL >> ~/.bashrc"
  - name: Export ORACLE_CUSTOM_METRICS_CONFIG
    shell: "echo export NR_CLI_ORACLEDB_CUSTOM_METRICS_CONFIG=/path/to/yaml/file  >> ~/.bashrc"
  - name: Export ORACLE_SYS_DBA
    shell: "echo export NR_CLI_ORACLEDB_SYS_DBA=false  >> ~/.bashrc"
  - name: Export ORACLE_SYS_OPER
    shell: "echo export NR_CLI_ORACLEDB_SYS_OPER=false  >> ~/.bashrc"
  - name: Export ORACLE_EXTENDED_METRICS
    shell: "echo export NR_CLI_ORACLEDB_EXTENDED_METRICS=false  >> ~/.bashrc"
  when: create_env_var|bool

