---
# Parameters:
# nrql_query: A query to run against the NRQL database through the Graphql API to see if an entity is reporting
# newrelic_personal_api_key: The newrelic personal api key. It typically starts with NRAK-
# newrelic_api_url: (optional) the URL for the newrelic REST API, default to main us URL

# Testing with EU
# - set_fact:
#     newrelic_api_url: "api.eu.newrelic.com"

#- fail:
#    msg: "A newrelic_personal_api_key is required. Create this entry in your user config file"
#  when: newrelic_personal_api_key is not defined
#
#- fail:
#    msg: "A nrql_query is required. Create this entry in your deploy config file"
#  when: nrql_query is not defined

#- name: Install curl on debian
#  package:
#    name: ["curl"]
#    update_cache: yes
#    state: latest
#  become: true
#  when: ansible_pkg_mgr == 'apt'
#
#- name: Install curl on RHEL
#  package:
#    name: ["curl"]
#    update_cache: yes
#    state: latest
#  become: true
#  when: ansible_pkg_mgr == 'yum'


- name: Pre-sanity check
  ansible.builtin.debug:
    msg: Before doing anything

# Query if entity is reporting
- block:
  - name: which curl
    shell: "which curl"

  - name: Curl something
    shell: "curl www.google.com"
  delegate_to: localhost

- name: Post-sanity check
  ansible.builtin.debug:
    msg: after doing everthing
